!function(a){var b="",c=new Array,d="",e=new Array,f="",g="",h="",l="",n="",o="",p="",q="",r="",s="";allSteps="",currentStep="",currentStepIndex="",loader="",isValidated=!1,isEmailFieldAdded=!1,style_id=0,noMapping=!1,modal="",whr_to_find="",insyncSource="",test_conn_btn="";var t={init:function(){var b=a("body");a(".cp-api-integration-form");f=a(".cp-md-modal-content button.cp-authenticate-connects"),g=a(".cp-md-modal-content button.cp-add-new-account"),h=a(".cp-md-modal-content button.cp-use-existing-account"),l=a(".cp-md-modal-content button.cp-next-connects"),n=a(".cp-md-modal-content button.cp-back-connects"),o=a(".cp-md-modal-content button.cp-save-connects"),p=a(".cp-md-content .cp-response-wrap"),q=a(".cp-add-new-account-form"),r=a(".cp-account-list-form"),s=a(".cp-api-integration-form"),mappingFrm=a(".cp-account-mapping-form"),allSteps=a(".cp-md-modal-content .cp-md-steps"),currentStep=a(".cp-md-modal-content .cp-md-steps li.cp-present-step"),loader=a(".cp-md-modal").find(".cp-md-loader"),isValidated=!1,isEdit=!1,style_id=a("#cp_style_id").val(),modal=a("#cp-md-modal-1"),whr_to_find=a(".cp-md-info-wrap"),test_conn_btn=a(".cp-test-connection"),whr_to_find.css("visibility","hidden"),b.delegate(".cp-md-trigger","click",this._serviceSelected),b.delegate("select[name=cp_select_account]","cp-invoke",this._serviceChange),b.delegate(".cp-remove-account","click",this._removeAccount),b.delegate(".cp-change-account","click",this._changeAccount),b.delegate(".cp-edit-account","click",this._changeAccount),b.delegate(".cp-customizer-remove-account","click",this._deleteAccount),b.delegate(".cp-md-close","click",this._removeAssets),g.on("click",this._addAccount),h.on("click",this._useExistingAccount),f.on("click",this._authenticateCredentials),n.on("click",this._backStepButton),l.on("click",this._nextStepButton),o.on("click",this._saveMeta),a(document).on("change",".cp-is_form-wrap select[name=is_form]",this._changeMauticForm),a(document).on("change",".cp-is_account_type-wrap select[name=is_account_type]",this._changeGetResponseAccountType),a(document).on("click",".cp-save",this._checkMapping),a(document).on("click",".cp-mapping-notice .error-close",this._closeWarning),a(document).on("change",".cp-mapping-fields select",this._mappingFieldChange),this._openPopup(),a(document).on("click",".cp-test-connection",this._testConnection)},_closeWarning:function(){a(".cp-mapping-notice").html("")},_checkMapping:function(){var b=a("#connect input[name=cp_mapping]").val(),c="",d=new Array,e=new Array,f=new Array,g=new Array;if(a(".cp-mapping-notice").html(""),"-1"!=b){c=JSON.parse(b),a(".cp-form-input-field").each(function(b,c){a(this).hasClass("cp-email")||d.push(a(this).attr("name"))}),e=d,a.each(c,function(a,b){var c=b.name;c.indexOf("{input}")===-1&&g.push(c)}),f=g;for(var h=0;h<d.length;h++)for(var i=0;i<g.length;i++){var j=g[i];_name=j.replace("cp_mapping{",""),_name=_name.replace("}",""),_name==d[h]&&(index=e.indexOf(d[h]),index>-1&&e.splice(index,1))}if(e.length>0){for(var k="",l="",m=cp_services.mapping_notice,n=a(".cp-connect-integration-meta .cp-change-account").data("service-title"),o=a(".cp-connect-integration-meta .cp-active-title").text(),h=0;h<e.length;h++)l=a(".cp-form-input-field[name="+e[h]+"]").data("placeholder"),k+='<div class="cp-error-wrap"><span class="cp-error-field">'+l+"</span></div>";m=m.replace("##mailer_name##",n),m=m.replace("##account_name##",o),a(".cp-mapping-notice").html(a("<div>",{"class":"cp-mapping-notice-wrap"})),a(".cp-mapping-notice-wrap").html(a("<div>",{"class":"cp-mapping-notice-head"}).append(a("<span>").html(m))),a(".cp-mapping-notice-wrap").append(a("<div>").append(k+'<span class="error-close">&times;<span>'))}}},_changeMauticForm:function(){var b=a(this).val();""!=b&&"-1"!=b?"api"==b?(a(".cp-public_key-wrap").show(),a(".cp-secret_key-wrap").show(),a(".cp-form_id-wrap").hide(),a(".cp-mautic_username-wrap").hide(),a(".cp-mautic_password-wrap").hide()):"m_up"==b?(a(".cp-public_key-wrap").hide(),a(".cp-secret_key-wrap").hide(),a(".cp-form_id-wrap").hide(),a(".cp-mautic_username-wrap").show(),a(".cp-mautic_password-wrap").show()):(a(".cp-public_key-wrap").hide(),a(".cp-secret_key-wrap").hide(),a(".cp-form_id-wrap").show(),a(".cp-mautic_username-wrap").hide(),a(".cp-mautic_password-wrap").hide()):(a(".cp-public_key-wrap").hide(),a(".cp-secret_key-wrap").hide(),a(".cp-form_id-wrap").hide(),a(".cp-mautic_username-wrap").hide(),a(".cp-mautic_password-wrap").hide())},_changeGetResponseAccountType:function(){var b=a(this).val();""==b||"-1"==b||"gr_com"!=b&&"gr_pl"!=b?a(".cp-getresponse_domain_name-wrap").hide():a(".cp-getresponse_domain_name-wrap").show()},_openPopup:function(){var b=t._getParameterByName("open_connects"),c=t._getParameterByName("account"),d=t._getParameterByName("service");"true"==b&&"null"!=c&&("mautic"==d&&a(".cp-connect-service-mautic").trigger("click"),"verticalresponse"==d&&a(".cp-connect-service-verticalresponse").trigger("click"),setTimeout(function(){t._startSettingsLoading(),s.find("input[type=radio][value="+c+"]").prop("checked",!0),l.trigger("click")},200))},_getParameterByName:function(a,b){b||(b=window.location.href),a=a.replace(/[\[\]]/g,"\\$&");var c=new RegExp("[?&]"+a+"(=([^&#]*)|&|#|$)"),d=c.exec(b);return d?d[2]?decodeURIComponent(d[2].replace(/\+/g," ")):"":null},_serviceChange:function(){noMapping=!0,t._updateErrorMsg(""),t._startSettingsLoading(),isEdit=!1,t._updateSteps(1);var b=a(this).val(),c=a(this).find("option[value="+b+"]").data("title"),e=cp_services.image_base_url+b+".png";return modal.find(".cp-md-modal-header img").attr("src",e),modal.find(".cp-md-modal-title").text(c+" Integration Setup"),-1==b||void 0==b?void t._updateErrorMsg(cp_services.wrong):(d=b,t.ajaxCall({action:"cppro_get_assets_data",service:b,addon_security:cpAddonModules.ajax_nonce},t._assetsDataComplete),r.find("input[name=cp-integration-service]").val(d),"mailpoet"==b||"mymail"==b?(s.hide(),r.show(),q.hide(),whr_to_find.css("visibility","hidden"),mappingFrm.hide(),g.hide(),h.hide(),l.show(),n.hide(),o.hide(),f.hide(),void t._getLists(b)):(s.show(),l.show(),r.hide(),q.hide(),whr_to_find.css("visibility","hidden"),mappingFrm.hide(),g.show(),h.hide(),n.hide(),o.hide(),f.hide(),t.ajaxCall({action:"cppro_render_service_accounts",service:b,selected:"",addon_security:cpAddonModules.ajax_nonce},t._serviceSelectedComplete),void t.ajaxCall({action:"cppro_render_service_settings",service:b,addon_security:cpAddonModules.ajax_nonce},t._serviceInputFieldsComplete)))},_removeAssets:function(){ConvertPlugServicesTrigger.removeHook("cp-service-getlist-click"),ConvertPlugServicesTrigger.removeHook("cp-service-list-validate"),a("script.cp-mailer-"+d+"-js").remove(),a("script.cp-mailer-"+d+"-css").remove(),modal.removeClass("cp-md-show")},_getisValidated:function(){return isValidated},_setisValidated:function(a){isValidated=a},_updateSteps:function(b){currentStepIndex=b,allSteps.find("li").removeClass("cp-present-step"),allSteps.find("li:nth-child("+b+")").removeClass("cp-past-step cp-future-step").addClass("cp-present-step"),allSteps.find("li:gt("+(b-1)+")").removeClass("cp-past-step").addClass("cp-future-step"),allSteps.find("li:lt("+(b-1)+")").removeClass("cp-future-step").addClass("cp-past-step"),a(".cp-md-modal .cp-md-contents").removeClass("cp-step-1 cp-step-2 cp-step-3"),a(".cp-md-modal .cp-md-contents").addClass("cp-step-"+b)},_changeAccount:function(){isEdit=!0;var b=a(this).data("source");"undefined"!=typeof b&&(insyncSource=b,noMapping=!0),t._updateErrorMsg(""),modal.addClass("cp-md-show"),t._startSettingsLoading(),t._updateSteps(1);var c=a(this).data("service"),e=a(this).data("account"),i=a(this).data("service-title");return d=c,r.find("input[name=cp-integration-service]").val(d),r.find("input[name=cp-integration-account-slug]").val(e),r.find("input[name=cp-integration-account-slug]").data("account-title",e),modal.find(".cp-md-modal-title").text(i+" Integration Setup"),modal.find(".cp-md-modal-header img").attr("src",cp_services.image_base_url+c+".png"),t.ajaxCall({action:"cppro_get_assets_data",service:c,addon_security:cpAddonModules.ajax_nonce},t._assetsDataComplete),"mailpoet"==e||"mymail"==e?(s.hide(),r.show(),q.hide(),whr_to_find.css("visibility","hidden"),mappingFrm.hide(),g.hide(),h.hide(),l.show(),n.hide(),o.hide(),f.hide(),void t._getLists(e)):(s.show(),r.hide(),q.hide(),whr_to_find.css("visibility","hidden"),mappingFrm.hide(),g.show(),h.hide(),n.hide(),o.hide(),f.hide(),l.show(),t.ajaxCall({action:"cppro_render_service_accounts",service:c,selected:e,addon_security:cpAddonModules.ajax_nonce},t._serviceSelectedComplete),void t.ajaxCall({action:"cppro_render_service_settings",service:c,addon_security:cpAddonModules.ajax_nonce},t._serviceInputFieldsComplete))},_deleteAccount:function(){var b=a(this),c=b.data("account-name"),e=b.data("isassociated"),f=!1;if(e>0){var g=cp_services.cant_delete.replace("##account_name##",c);return void t._updateErrorMsg(g)}var h=cp_services.confirm_delete.replace("##account_name##",c);if(confirm(h)){t._startSettingsLoading(),f=b.closest(".cp-customizer-radio").find("input").attr("data-selected-account");var i=a(this).data("account-slug");t.ajaxCall({action:"cppro_delete_service_account",account:i,addon_security:cpAddonModules.ajax_nonce},function(a){var c=JSON.parse(a);c.error||(b.closest(".cp-service_accounts-wrap").empty(),t.ajaxCall({action:"cppro_render_service_accounts",service:d,selected:"",addon_security:cpAddonModules.ajax_nonce},t._serviceSelectedComplete))})}},_removeAccount:function(){confirm(cp_services.confirm_remove)&&(t._startSettingsLoading(),a("#connect input[name=cp_mapping]").val(-1),a("#connect input[name=cp_connect_settings]").val(-1),t.ajaxCall({action:"cppro_save_meta_settings",style_id:style_id,cp_mapping:-1,cp_taxonomy:-1,addon_security:cpAddonModules.ajax_nonce},t._metaDeleteComplete))},_metaDeleteComplete:function(b){var c=JSON.parse(b);c.error?(t._finishSettingsLoading(),t._updateErrorMsg(c.error)):(a("#connect .cp-connect-integration-meta").addClass("cp-hidden"),a("#connect .cp-connect-integration-wrap").removeClass("cp-hidden"),t._finishSettingsLoading(),a(".cp-md-close").trigger("click"))},_backStepButton:function(){if(t._updateErrorMsg(""),t._startSettingsLoading(),2==currentStepIndex){t._useExistingAccount();var b=a(".cp-customizer-radio"),c=b.find("input:checked").val();t.ajaxCall({action:"cppro_render_service_accounts",service:d,selected:void 0==typeof c?"":c,addon_security:cpAddonModules.ajax_nonce},function(a){var c=JSON.parse(a);if(c.error)0==c.account_count?(t._addAccount(),h.hide()):(l.addClass("cp-disable"),s.find(".cp-api-selection-list").html("")),t._updateErrorMsg(c.error);else{if(t._updateErrorMsg(""),l.removeClass("cp-disable"),s.find(".cp-api-selection-list").html(c.html),b.length>0){var d=b.find("input:checked");d.length>0&&d.attr("data-selected-account","active")}1==b.length&&b.find("input").attr("checked","checked")}})}else t._updateSteps(2),r.show(),s.hide(),q.hide(),whr_to_find.css("visibility","hidden"),mappingFrm.hide(),g.hide(),h.hide(),l.show(),n.show(),o.hide(),f.hide();t._finishSettingsLoading()},_nextStepButton:function(){l.hasClass("cp-disable")||(t._updateErrorMsg(""),1==currentStepIndex?t._connectionChanged():t._cpGenerateFieldsMapping())},_saveMeta:function(){if(!o.hasClass("cp-disable")){t._startSettingsLoading(),ConvertPlugServicesTrigger.removeHook("cp-service-getlist-click"),ConvertPlugServicesTrigger.removeHook("cp-service-list-validate");var b=window.location.href,c="",d=t._getParameterByName("open_connects");if("true"==d&&(c=b.replace("&open_connects=true",""),setTimeout(function(){history.pushState({},null,c)},200)),1==noMapping){var e=JSON.stringify(r.serializeArray());a("input[name=cp_connection_values]").val(e),a("select[name=cp_select_account]").addClass("cp-hidden"),t._saveInSync()}else{var f=JSON.stringify(mappingFrm.serializeArray()),g=JSON.stringify(r.serializeArray());a("#connect input[name=cp_mapping]").val(f),a("#connect input[name=cp_connect_settings]").val(g);var h=r.find("input[name=cp-integration-service]").val();t.ajaxCall({action:"cppro_save_meta_settings",style_id:style_id,cp_mapping:f,cp_taxonomy:g,service:h,addon_security:cpAddonModules.ajax_nonce},t._metaSavedComplete)}a(document).trigger("cpro_after_save_mapping",[mappingFrm.serializeArray(),r.serializeArray()])}},_saveInSync:function(){var b=r.find("input[name=cp-integration-account-slug]").val(),c=r.find("input[name=cp-integration-service]").val(),d=a(".cp-insync-content-wrap .cp_connection_row").find(".cp-connect-integration-meta .cp-meta-wrap img"),e="",f=r.find("input[name=cp-integration-account-slug]").data("account-title");"mailpoet"!=c&&"mymail"!=c||(f="mailpoet"==c?"MailPoet":"MyMail"),e=cp_services.image_base_url+c+".png",d.attr("src",e),a(".cp-insync-content-wrap .cp_connection_row .cp-connect-integration-meta").removeClass("cp-hidden"),a(".cp-insync-content-wrap .cp_connection_row .cp-connect-integration-wrap").addClass("cp-hidden"),a(".cp-insync-content-wrap .cp_connection_row").find(".cp-active-title").html(f),a(".cp-insync-content-wrap .cp_connection_row .cp-change-account").attr("data-account",b),a(".cp-insync-content-wrap .cp_connection_row .cp-change-account").attr("data-service",c),a(".cp-insync-content-wrap .cp_connection_row .cp-change-account").attr("data-service-title",c),a(".cp-insync-content-wrap .cp_connection_row .cp-disconnect-account").attr("data-account",b),t._finishSettingsLoading(),a(".cp-md-close").trigger("click")},_metaSavedComplete:function(b){var c=JSON.parse(b);if(c.error)t._finishSettingsLoading(),t._updateErrorMsg(c.error);else{var d=r.find("input[name=cp-integration-account-slug]").val(),e=r.find("input[name=cp-integration-service]").val(),f=a("#connect").find(".cp-connect-integration-meta .cp-meta-wrap img"),g="",h=r.find("input[name=cp-integration-account-slug]").data("account-title"),i=c.has_test_connection;i?(a(".cp-test-connection").removeClass("cp-hidden"),a(".cp-test-connection").data("account",d),a(".cp-test-connection").data("service",e)):a(".cp-test-connection").addClass("cp-hidden"),"mailpoet"!=e&&"mymail"!=e||(h="mailpoet"==e?"MailPoet":"MyMail"),g=cp_services.image_base_url+e+".png",f.attr("src",g),a("#connect .cp-connect-integration-meta").removeClass("cp-hidden"),a("#connect .cp-connect-integration-wrap").addClass("cp-hidden"),a("#connect").find(".cp-active-title").html(h),a("#connect .cp-change-account").data("account",d),a("#connect .cp-change-account").data("service",e),a("#connect .cp-change-account").data("service-title",e),a("#connect .cp-remove-account").data("account",d),t._finishSettingsLoading(),a(".cp-md-close").trigger("click")}a("#connect").scrollTop(0)},_mappingFieldChange:function(){var b=a(this).val(),c=a(this).closest("tr").find("input[type=text]");"custom_field"==b?c.show():c.hide()},_serviceSaveComplete:function(a){var b=JSON.parse(a);b.error?(t._finishSettingsLoading(),t._updateErrorMsg(b.error)):(t._startSettingsLoading(),r.find("input[name=cp-integration-account-slug]").val(b.term_id),r.find("input[name=cp-integration-service]").val(d),s.hide(),r.show(),q.hide(),whr_to_find.css("visibility","hidden"),mappingFrm.hide(),g.hide(),h.hide(),l.show(),n.show(),o.hide(),f.hide(),t._updateSteps(2),t._getLists(b.term_id))},_getLists:function(a){r.find("input[name=cp-integration-account-slug]").val(a),t.ajaxCall({action:"cppro_render_service_fields",account:a,isEdit:isEdit,style_id:style_id,noMapping:noMapping,src:insyncSource,addon_security:cpAddonModules.ajax_nonce},t._serviceFieldsComplete)},_authenticateCredentials:function(){t._updateErrorMsg("");var a=t.serializeFormJSON(q),b=window.location.href.split("#")[0];t._startSettingsLoading(),t.ajaxCall({action:"cppro_connect_service",service:d,fields:a,currentUrl:b,addon_security:cpAddonModules.ajax_nonce},t._authenticateCredentialsComplete)},_authenticateCredentialsComplete:function(a){var b=JSON.parse(a),c=t.serializeFormJSON(q);if(account_title=q.find("input[name=service_account]").val(),b.error)return t._finishSettingsLoading(),t._updateErrorMsg(b.error),!1;if(r.find("input[name=cp-integration-account-slug]").data("account-title",account_title),l.removeClass("cp-disable"),"mautic"==d){var e=q.find(".cp-api-fields select[name=is_form]").val();if("form"==e||"m_up"==e)t.ajaxCall({action:"cppro_save_service_settings",serviceData:c,service:d,addon_security:cpAddonModules.ajax_nonce},t._serviceSaveComplete);else{var f=b.data.redirect_url;window.location=f}}else if("verticalresponse"==d){var f=b.data.url;window.location=f}else t.ajaxCall({action:"cppro_save_service_settings",serviceData:c,service:d,addon_security:cpAddonModules.ajax_nonce},t._serviceSaveComplete)},_addAccount:function(){t._updateErrorMsg(""),f.show(),h.show(),l.hide(),g.hide(),o.hide(),g.hide(),s.hide(),r.hide(),q.show(),whr_to_find.css("visibility","visible"),mappingFrm.hide()},_useExistingAccount:function(){t._startSettingsLoading(),s.show(),r.hide(),q.hide(),whr_to_find.css("visibility","hidden"),mappingFrm.hide(),g.show(),h.hide(),l.show(),n.hide(),o.hide(),f.hide(),t._updateSteps(1),t._updateErrorMsg(""),t._finishSettingsLoading()},_serviceSelected:function(){t._updateErrorMsg(""),t._startSettingsLoading(),isEdit=!1,t._updateSteps(1);var b=a(this).find(".cp-connect-service-list").data("service"),c=a(this).find(".cp-services-title").data("title"),e=a(this).find("img").attr("src");return modal.find(".cp-md-modal-header img").attr("src",e),modal.find(".cp-md-modal-title").text(c+" Integration Setup"),-1==b||void 0==b?void t._updateErrorMsg(cp_services.wrong):(d=b,t.ajaxCall({action:"cppro_get_assets_data",service:b,addon_security:cpAddonModules.ajax_nonce},t._assetsDataComplete),r.find("input[name=cp-integration-service]").val(d),"mailpoet"==b||"mymail"==b?(s.hide(),r.show(),q.hide(),whr_to_find.css("visibility","hidden"),mappingFrm.hide(),g.hide(),h.hide(),l.show(),n.hide(),o.hide(),f.hide(),void t._getLists(b)):(s.show(),l.show(),r.hide(),q.hide(),whr_to_find.css("visibility","hidden"),mappingFrm.hide(),g.show(),h.hide(),n.hide(),o.hide(),f.hide(),t.ajaxCall({action:"cppro_render_service_accounts",service:b,selected:"",addon_security:cpAddonModules.ajax_nonce},t._serviceSelectedComplete),void t.ajaxCall({action:"cppro_render_service_settings",service:b,addon_security:cpAddonModules.ajax_nonce},t._serviceInputFieldsComplete)))},_assetsDataComplete:function(b){var c=JSON.parse(b);if(0==c.error){var e=a("<div>"+c.assets+"</div>"),f=e.find("link.cp-mailer-"+d+"-css"),g=e.find("script.cp-mailer-"+d+"-js");g.length>0&&(a("script.cp-mailer-"+d+"-js").remove(),a("html").append(g)),f.length>0&&(a("script.cp-mailer-"+d+"-css").remove(),a("head").append(f))}},_serviceSelectedComplete:function(b){var c=JSON.parse(b);if(a(".cp-md-info-wrap a").attr("href",c.url),c.error)0==c.account_count?(t._addAccount(),h.hide()):(l.addClass("cp-disable"),s.find(".cp-api-selection-list").html(""));else{t._updateErrorMsg(""),l.removeClass("cp-disable"),s.find(".cp-api-selection-list").html(c.html);var d=a(".cp-customizer-radio");if(d.length>0){var e=d.find("input:checked");e.length>0&&e.attr("data-selected-account","active")}1==d.length&&d.find("input").attr("checked","checked")}t._finishSettingsLoading()},_connectionChanged:function(){mappingFrm.find(".cp-success-msg").remove(),t._startSettingsLoading();var b=a(".cp-api-integration-form").find(".cp-customizer-radio input:checked"),c=a(".cp-api-integration-form").find(".cp-customizer-radio input:checked").data("account-name");if(b.length<1)return t._updateErrorMsg(cp_services.select_account),void t._finishSettingsLoading();var d=b.val();if(r.find("input[name=cp-integration-account-slug]").data("account-title",c),isEdit)if(noMapping){var e=a(".cp-save-"+insyncSource+"-form .cp-edit-account").data("account");e!=d?isEdit=!1:isEdit=!0}else{var e=a("#connect .cp-change-account").data("account");e!=d?isEdit=!1:isEdit=!0}t._getLists(d)},_tooltipInit:function(){a(".bsf-has-tip, .has-tip").each(function(b,c){$tip=a(c);var d="undefined"!=typeof $tip.attr("data-attribute")?$tip.attr("data-attribute"):"title",e="undefined"!=typeof $tip.attr("data-offset")?$tip.attr("data-offset"):10,f="undefined"!=typeof $tip.attr("data-position")?$tip.attr("data-position"):"top",g="undefined"!=typeof $tip.attr("data-trigger")?$tip.attr("data-trigger"):"hover,focus",h="undefined"!=typeof $tip.attr("data-classes")?"tip "+$tip.attr("data-classes"):"tip";$tip.frosty({className:h,attribute:d,offset:e,position:f,trigger:g})})},_serviceFieldsComplete:function(a){var c=JSON.parse(a),e=r.find(".cp-new-account-fields");c.error?t._updateErrorMsg(c.error):(t._tooltipInit(),ConvertPlugServicesTrigger.triggerHook("cp-service-getlist-click",t),t._updateErrorMsg(""),t._updateSteps(2),r.show(),s.hide(),q.hide(),whr_to_find.css("visibility","hidden"),mappingFrm.hide(),g.hide(),h.hide(),l.show(),n.show(),o.hide(),f.hide(),e.html(c.html),b=c.mapping_fields,"mailpoet"!=d&&"mymail"!=d||n.hide(),noMapping&&(o.show(),l.hide())),t._finishSettingsLoading()},_cpGenerateFieldsMapping:function(){mappingFrm.find(".cp-success-msg").remove();var j=0,k=0;return isEmailFieldAdded=!1,ConvertPlugServicesTrigger.triggerHook("cp-service-list-validate",t),isValidated?void t._updateErrorMsg(isValidated):(s.hide(),r.hide(),q.hide(),whr_to_find.css("visibility","hidden"),mappingFrm.show(),g.hide(),h.hide(),l.hide(),n.show(),o.show(),f.hide(),"mailpoet"!=d&&"mymail"!=d||n.hide(),c=new Array,e=new Array,a(".cp-form-input-field").each(function(){a(this).hasClass("cp-email")&&(isEmailFieldAdded=!0);var d=a(this),f=d.attr("name"),g=f.replace(/[^a-z0-9\s]/gi,"").toLowerCase(),h=!0;for(i=0;i<b.length;i++)b[i].toLowerCase()==g&&(c[k]={name:b[i],value:a(this)},h=!1,k++);h&&"paramemail"!=g&&(e[j]={name:"custom_field",value:a(this)},j++)}),t._cpAllocateFieldsMapping(),void t._updateSteps(3))},_updateErrorMsg:function(a){p.html(a),""!=a?p.addClass("cp-response-failure"):p.removeClass("cp-response-failure")},_cpAllocateFieldsMapping:function(){var b="",d="",f=mappingFrm.find(".cp-mapping-fields"),g=f.find("table tbody");if(g.html(""),o.removeClass("cp-disable"),c.length>0||e.length>0){for(g.append("<tr><th>"+cp_services.cp_fields+"</th><th>"+cp_services.mailer_fields+"</th></tr>"),i=0;i<c.length;i++){g.append(a("<tr>"));var h=c[i].value.attr("name"),l="<label>"+c[i].value.attr("data-placeholder")+"</label>",n=g.find("tr:eq("+(i+1)+")");b=t._getMappingOptionsHTML(h),n.append(a("<td>").append(l)),n.append(a("<td>").append(a("<select>").attr("name","cp_mapping{"+h+"}").append(a(b)))),n.append(a("<td>").append(a("<input>",{type:"text",val:"",placeholder:cp_services.placeholder,name:"cp_mapping{"+h+"}{input}"})))}for(d=c.length+e.length,k=0,j=i;j<d;j++,k++){g.append(a("<tr>"));var h=e[k].value.attr("name"),l="<label>"+e[k].value.attr("data-placeholder")+"</label>",n=g.find("tr:eq("+(j+1)+")");b=t._getMappingOptionsHTML(""),n.append(a("<td>").append(l)),n.append(a("<td>").append(a("<select>").attr("name","cp_mapping{"+h+"}").append(a(b)))),n.append(a("<td>").append(a("<input>",{type:"text",val:"","class":"",id:"",name:"cp_mapping{"+h+"}{input}"})))}if(isEdit){var p=JSON.parse(a("#connect input[name=cp_mapping]").val());for(m=0;m<p.length;m++)g.find("select[name='"+p[m].name+"']").val(p[m].value),g.find("input[name='"+p[m].name+"']").val(p[m].value),"custom_field"==p[m].value?g.find("input[name='"+p[m].name+"{input}']").show():g.find("input[name='"+p[m].name+"{input}']").hide()}isEmailFieldAdded||t._updateErrorMsg(cp_services.no_email)}else 1==a(".cp-form-input-field").length?a(".cp-form-input-field").hasClass("cp-email")?(mappingFrm.find(".cp-mapping-fields").after(a("<div/>").addClass("cp-success-msg").append("<span/>").text(cp_services.only_email)),o.removeClass("cp-disable")):(t._updateErrorMsg(cp_services.no_email),o.removeClass("cp-disable")):(t._updateErrorMsg(cp_services.no_input),o.addClass("cp-disable"))},_getMappingOptionsHTML:function(a){var c="",d=0,e="";if("undefined"!=typeof a){for(c+='<option value="-1">'+cp_services.select_option+"</option>",d=0;d<b.length;d++)e=a.toLowerCase()==b[d].toLowerCase()?' selected="selected" ':"",c+='<option value="'+b[d]+'" '+e+">"+b[d]+"</option>";c+='<option value="custom_field">'+cp_services.custom_field+"</option>"}return c},serializeFormJSON:function(b){var c={},d=b.serializeArray();return a.each(d,function(){c[this.name]?(c[this.name].push||(c[this.name]=[c[this.name]]),c[this.name].push(this.value||"")):c[this.name]=this.value||""}),c},ajaxCall:function(b,c){a.ajax({data:b,action:b.action,url:cp_services.url,success:c,method:"post",success:c})},_startSettingsLoading:function(a){loader.removeClass("cp-hidden")},_finishSettingsLoading:function(){loader.addClass("cp-modal-loaded"),setTimeout(function(){loader.addClass("cp-hidden"),loader.removeClass("cp-modal-loaded")},300)},_serviceInputFieldsComplete:function(a){var b=JSON.parse(a),c=q.find(".cp-new-account-fields");b.error?t._updateErrorMsg(b.error):c.html(b.html)},_testConnection:function(){var b=a(this).data("account"),c=a(this).data("service");a(this).text(cp_services.testing_connection),t.ajaxCall({action:"cppro_test_connection",account:b,style_id:a("#cp_style_id").val(),service:c,addon_security:cpAddonModules.ajax_nonce},t._testComplete)},_testComplete:function(a){test_conn_btn.text(cp_services.tested),setTimeout(function(){test_conn_btn.text(cp_services.test_conn_title)},1200)}};a(function(){t.init()})}(jQuery),function(a){ConvertPlugServicesTrigger={triggerHook:function(b,c){a("body").trigger("cp-services-trigger."+b,c)},addHook:function(b,c){a("body").on("cp-services-trigger."+b,c)},removeHook:function(b){a("body").off("cp-services-trigger."+b)}}}(jQuery);